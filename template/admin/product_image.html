{% extends "index.html" %}
{% load rest_framework %}
{% block menu %}
{% include "admin/admin-nav.html" %}
{% endblock menu %}

{% block content %}
<div class="container">
    {{title}}
    <form id="updateUserForm" class="form-horizontal"
        data-update-url="/myadmin/products/{{product_id}}/images/{{image.id}}/">
        <fieldset>



            {% render_form serializer %}

            <div class="form-action offset-sm-4 col-sm-8">
                <p id="formerror" class="text-danger text-start my-2"></p>

                <button type="button" id="saveUserButton" class="btn btn-primary">
                    Save Product Image
                </button>


                <a class="btn btn-outline-warning col-4 fs-6" href="{%url 'product_images-list' product_id%}">Product
                    Images</a>
            </div>

        </fieldset>
    </form>
</div>

<!-- Block -->
<div class="modal fade" id="blockModal" tabindex="-1" aria-labelledby="userBlockModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content ">
            <div class="modal-header">

                <h1 class="modal-title fs-5" id="exampleModalLabel"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="blockform" action="" method="post">
                {% csrf_token %}
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button id="blockbtn" type="button" class="btn btn-primary">Hide Product</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- UnBlock -->
<div class="modal fade" id="unblockModal" tabindex="-1" aria-labelledby="userUnblockModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content ">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Unide Product</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="unblockform" action="" method="post">
                {% csrf_token %}
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button id="unblockbtn" type="button" class="btn btn-primary">Unblock User</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>

    document.addEventListener('DOMContentLoaded', function () {
        const saveUserButton = document.getElementById('saveUserButton');
        const updateUserForm = document.getElementById('updateUserForm');
        const updateUrl = updateUserForm.getAttribute('data-update-url')
        const blockbtn = document.getElementById('blockbtn')
        const unblockbtn = document.getElementById('unblockbtn')
        console.log(updateUrl)

        update = (data) => {
            console.log(data)
            fetch(updateUrl, {
                method: 'PUT',
                body: data,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
                .then(response => {

                    if (response.status === 200) {
                        window.location.href = '/myadmin/products/{{product_id}}/images/'
                    } else {
                        return response.text()
                    }

                })
                .then(data => {
                    if (data != undefined) {
                        formError = document.getElementById('formerror')
                        formError.innerText = `Please enter a valid ${data}`
                        console.log(data)
                    }
                })

        }
        saveUserButton.addEventListener('click', function () {
            const formData = new FormData(updateUserForm);
            console.log(formData)
            update(formData)

        });

    });
</script>

{% endblock content %}